function e(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire5e30,r=t.register;r("jBB2H",function(r,i){e(r.exports,"Aggregate",function(){return y});var n=t("8KO5M"),a=t("jWywI"),s=t("4UPGI"),o=t("9EKMI"),c=t("3DmF0"),l=t("jkuUu"),u=t("1Z3KE"),g=t("4he1m"),h=t("bu0p3"),p=t("hcIxM"),f=t("b7nLr"),m=t("e29aQ"),d=t("8tgg9");class y extends c.AggregateBase{static featureName=s.FEATURE_NAME;constructor(e){super(e,s.FEATURE_NAME),this.eventsPerHarvest=1e3,this.referrerUrl=o.isBrowserScope&&document.referrer?(0,a.cleanURL)(document.referrer):void 0,this.waitForFlags(["ins"]).then(([t])=>{if(!t){this.blocked=!0,this.deregisterDrain();return}this.trackSupportabilityMetrics(),(0,g.registerHandler)("api-recordCustomEvent",(e,t,r)=>{if(s.RESERVED_EVENT_TYPES.includes(t))return(0,l.warn)(46);this.addEvent({eventType:t,timestamp:this.toEpoch(e),...r})},this.featureName,this.ee),e.init.page_action.enabled&&(0,g.registerHandler)("api-addPageAction",(e,t,r,i)=>{if(!this.agentRef.runtime.entityManager.get(i))return(0,l.warn)(56,this.featureName);this.addEvent({...r,eventType:"PageAction",timestamp:this.toEpoch(e),timeSinceLoad:e/1e3,actionName:t,referrerUrl:this.referrerUrl,...o.isBrowserScope&&{browserWidth:window.document.documentElement?.clientWidth,browserHeight:window.document.documentElement?.clientHeight}},i)},this.featureName,this.ee);let r=()=>{};o.isBrowserScope&&e.init.user_actions.enabled&&(this.userActionAggregator=new(0,f.UserActionsAggregator),this.harvestOpts.beforeUnload=()=>r?.(this.userActionAggregator.aggregationEvent),r=e=>{try{if(e?.event){let{target:t,timeStamp:r,type:i}=e.event;this.addEvent({eventType:"UserAction",timestamp:this.toEpoch(r),action:i,actionCount:e.count,actionDuration:e.relativeMs[e.relativeMs.length-1],actionMs:e.relativeMs,rageClick:e.rageClick,target:e.selectorPath,...(0,m.isIFrameWindow)(window)&&{iframe:!0},...this.agentRef.init.user_actions.elementAttributes.reduce((r,i)=>{var n,a;return n=i,"window"!==e.selectorPath&&"document"!==e.selectorPath&&t instanceof HTMLElement&&t?.[n]&&(r[a=i,"tagName"===a&&(a="tag"),"className"===a&&(a="class"),"target".concat(a.charAt(0).toUpperCase()+a.slice(1))]=String(t[i]).trim().slice(0,128)),r},{}),...e.nearestTargetFields})}}catch(e){}},(0,g.registerHandler)("ua",e=>{r(this.userActionAggregator.process(e,this.agentRef.init.user_actions.elementAttributes))},this.featureName,this.ee));let i=[...e.init.performance.capture_marks?["mark"]:[],...e.init.performance.capture_measures?["measure"]:[]];if(i.length)try{i.forEach(t=>{PerformanceObserver.supportedEntryTypes.includes(t)&&new PerformanceObserver(r=>{r.getEntries().forEach(r=>{try{var i;this.reportSupportabilityMetric("Generic/Performance/"+t+"/Seen");let n=e.init.performance.capture_detail?(i=r.detail,null==i?{}:(0,d.isPureObject)(i)?function e(t,r="entryDetail"){let i={};return null==t||Object.keys(t).forEach(n=>{let a=r+"."+n;(0,d.isPureObject)(t[n])?Object.assign(i,e(t[n],a)):null!==t[n]&&void 0!==t[n]&&(i[a]=t[n])}),i}(i):{entryDetail:i}):{};this.addEvent({...n,eventType:"BrowserPerformance",timestamp:this.toEpoch(r.startTime),entryName:(0,a.cleanURL)(r.name),entryDuration:r.duration,entryType:t})}catch(e){}})}).observe({buffered:!0,type:t})})}catch(e){}o.isBrowserScope&&e.init.performance.resources.enabled&&(0,g.registerHandler)("browserPerformance.resource",t=>{try{let{name:r,duration:i,...n}=t.toJSON(),a=!1;try{let t=new URL(r).hostname,i=t.includes("newrelic.com")||t.includes("nr-data.net")||t.includes("nr-local.net");if(this.agentRef.init.performance.resources.ignore_newrelic&&i||this.agentRef.init.performance.resources.asset_types.length&&!this.agentRef.init.performance.resources.asset_types.includes(n.initiatorType))return;(a=t===o.globalScope?.location.hostname||e.init.performance.resources.first_party_domains.includes(t))&&this.reportSupportabilityMetric("Generic/Performance/FirstPartyResource/Seen"),i&&this.reportSupportabilityMetric("Generic/Performance/NrResource/Seen")}catch(e){}this.reportSupportabilityMetric("Generic/Performance/Resource/Seen");let s={...n,eventType:"BrowserPerformance",timestamp:Math.floor(e.runtime.timeKeeper.correctRelativeTimestamp(n.startTime)),entryName:r,entryDuration:i,firstParty:a};this.addEvent(s)}catch(e){this.ee.emit("internal-error",[e,"GenericEvents-Resource"])}},this.featureName,this.ee),e.runtime.harvester.triggerHarvestFor(this),this.drain()})}addEvent(e={},t){if(!e||!Object.keys(e).length)return;if(!e.eventType)return void(0,l.warn)(44);for(let t in e){let r=e[t];e[t]=r&&"object"==typeof r?(0,n.stringify)(r):r}let r={timestamp:Math.floor(this.agentRef.runtime.timeKeeper.correctRelativeTimestamp((0,u.now)())),pageUrl:(0,a.cleanURL)(""+o.initialLocation),currentUrl:(0,a.cleanURL)(""+location)},i={...this.agentRef.info.jsAttributes||{},...r,...e};this.events.add(i,t)||this.events.isEmpty(void 0,t)||(this.ee.emit(h.SUPPORTABILITY_METRIC_CHANNEL,["GenericEvents/Harvest/Max/Seen"]),this.agentRef.runtime.harvester.triggerHarvestFor(this,{targetEntityGuid:t}),this.events.add(i))}serializer(e){return(0,p.applyFnToProps)({ins:e},this.obfuscator.obfuscateString.bind(this.obfuscator),"string")}queryStringsBuilder(){return{ua:this.agentRef.info.userAttributes,at:this.agentRef.info.atts}}toEpoch(e){return Math.floor(this.agentRef.runtime.timeKeeper.correctRelativeTimestamp(e))}trackSupportabilityMetrics(){let e="Config/Performance/";this.agentRef.init.performance.capture_marks&&this.reportSupportabilityMetric(e+"CaptureMarks/Enabled"),this.agentRef.init.performance.capture_measures&&this.reportSupportabilityMetric(e+"CaptureMeasures/Enabled"),this.agentRef.init.performance.resources.enabled&&this.reportSupportabilityMetric(e+"Resources/Enabled"),this.agentRef.init.performance.resources.asset_types?.length!==0&&this.reportSupportabilityMetric(e+"Resources/AssetTypes/Changed"),this.agentRef.init.performance.resources.first_party_domains?.length!==0&&this.reportSupportabilityMetric(e+"Resources/FirstPartyDomains/Changed"),!1===this.agentRef.init.performance.resources.ignore_newrelic&&this.reportSupportabilityMetric(e+"Resources/IgnoreNewrelic/Changed")}}}),r("hcIxM",function(t,r){e(t.exports,"applyFnToProps",function(){return function e(t,r,i="string",n=[]){return t&&"object"==typeof t&&Object.keys(t).forEach(a=>{"object"==typeof t[a]?e(t[a],r,i,n):typeof t[a]!==i||n.includes(a)||(t[a]=r(t[a]))}),t}})}),r("b7nLr",function(r,i){e(r.exports,"UserActionsAggregator",function(){return o});var n=t("kFzvb"),a=t("4UPGI"),s=t("biMpD");class o{#e=void 0;#t="";get aggregationEvent(){let e=this.#e;return this.#t="",this.#e=void 0,e}process(e,t){var r,i;let o;if(!e)return;let{selectorPath:c,nearestTargetFields:l}=function(e,t){let r,i={};if(a.OBSERVED_WINDOW_EVENTS.includes(e.type)||e.target===window)r="window";else if(e.target===document)r="document";else{let{path:a,nearestFields:s}=(0,n.generateSelectorPath)(e.target,t);r=a,i=s}return{selectorPath:r,nearestTargetFields:i}}(e,t),u=(r=e,i=c,o=r.type,"scrollend"!==r.type&&(o+="-"+i),o);if(u&&u===this.#t)this.#e.aggregate(e);else{let t=this.#e;return this.#t=u,this.#e=new(0,s.AggregatedUserAction)(e,c,l),t}}}}),r("kFzvb",function(t,r){e(t.exports,"generateSelectorPath",function(){return i});let i=(e,t=[])=>{if(!e)return{path:void 0,nearestFields:{}};let r="",i=(e=>{try{let t=1,{tagName:r}=e;for(;e.previousElementSibling;)e.previousElementSibling.tagName===r&&t++,e=e.previousElementSibling;return t}catch(e){}})(e),n={};try{for(;e?.tagName;){let{id:i,localName:a}=e;t.forEach(t=>{var r;n[r=t,"tagName"===r&&(r="tag"),"className"===r&&(r="class"),"nearest".concat(r.charAt(0).toUpperCase()+r.slice(1))]||=e[t]?.baseVal||e[t]}),r=[a,i?"#".concat(i):"",r?">".concat(r):""].join(""),e=e.parentNode}}catch(e){}return{path:r?i?"".concat(r,":nth-of-type(").concat(i,")"):r:void 0,nearestFields:n}}}),r("biMpD",function(r,i){e(r.exports,"AggregatedUserAction",function(){return a});var n=t("4UPGI");class a{constructor(e,t,r){this.event=e,this.count=1,this.originMs=Math.floor(e.timeStamp),this.relativeMs=[0],this.selectorPath=t,this.rageClick=void 0,this.nearestTargetFields=r}aggregate(e){this.count++,this.relativeMs.push(Math.floor(e.timeStamp-this.originMs)),this.isRageClick()&&(this.rageClick=!0)}isRageClick(){let e=this.relativeMs.length;return"click"===this.event.type&&e>=n.RAGE_CLICK_THRESHOLD_EVENTS&&this.relativeMs[e-1]-this.relativeMs[e-n.RAGE_CLICK_THRESHOLD_EVENTS]<n.RAGE_CLICK_THRESHOLD_MS}}}),r("e29aQ",function(t,r){e(t.exports,"isIFrameWindow",function(){return i});function i(e){return!!e&&e.self!==e.top}}),r("8tgg9",function(t,r){e(t.exports,"isPureObject",function(){return i});function i(e){return e?.constructor===({}).constructor}});
//# sourceMappingURL=aggregate.31dad227.js.map

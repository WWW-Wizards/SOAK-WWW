!function(){function e(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire5e30,i=t.register;i("bxyEV",function(i,r){e(i.exports,"Aggregate",function(){return b});var n=t("7CBaz"),s=t("6H82V"),o=t("gSI6b"),a=t("4qjOv"),f=t("95KVp"),c=t("6cMq7"),u=t("cARWO"),d=t("73gWV"),m=t("6Lc7k"),p=t("27uK3"),l=t("kI9nw"),h=t("hP1Bb"),g=t("7nvKd"),T=t("jL9ao"),y=t("jHSql"),E=t("8auZx"),v=t("2cGfe");class b extends m.AggregateBase{static featureName=f.FEATURE_NAME;constructor(e){if(super(e,f.FEATURE_NAME),this.timeToFirstByte=0,this.firstByteToWindowLoad=0,this.firstByteToDomContent=0,(0,E.registerHandler)("send-rum",(e,t)=>{this.sendRum(e,t)},this.featureName,this.ee),!(0,a.isValid)(e.info))return this.ee.abort(),(0,d.warn)(43);e.runtime.timeKeeper=new(0,T.TimeKeeper)(e.runtime.session),n.isBrowserScope?h.timeToFirstByte.subscribe(({value:e,attrs:t})=>{let i=t.navigationEntry;this.timeToFirstByte=Math.max(e,this.timeToFirstByte),this.firstByteToWindowLoad=Math.max(Math.round(i.loadEventEnd-this.timeToFirstByte),this.firstByteToWindowLoad),this.firstByteToDomContent=Math.max(Math.round(i.domContentLoadedEventEnd-this.timeToFirstByte),this.firstByteToDomContent),this.sendRum()}):this.sendRum()}sendRum(e=this.agentRef.info.jsAttributes,t={licenseKey:this.agentRef.info.licenseKey,applicationID:this.agentRef.info.applicationID}){let i,r=this.agentRef.info,a={};r.queueTime&&(a.qt=r.queueTime),r.applicationTime&&(a.ap=r.applicationTime),a.be=this.timeToFirstByte,a.fe=this.firstByteToWindowLoad,a.dc=this.firstByteToDomContent;let f={tt:r.ttGuid,us:r.user,ac:r.account,pr:r.product,af:(0,c.getActivatedFeaturesFlags)(this.agentIdentifier).join(","),...a,xx:r.extra,ua:r.userAttributes,at:r.atts};if(this.agentRef.runtime.session&&(f.fsh=Number(this.agentRef.runtime.session.isNew)),"object"==typeof e&&Object.keys(e).length>0&&(i=(0,y.applyFnToProps)({ja:e},this.obfuscator.obfuscateString.bind(this.obfuscator),"string")),n.globalScope.performance){if("undefined"!=typeof PerformanceNavigationTiming){let e=n.globalScope?.performance?.getEntriesByType("navigation")?.[0],t={timing:(0,s.addPT)(n.originTime,e,{}),navigation:(0,s.addPN)(e,{})};f.perf=(0,o.stringify)(t)}else if("undefined"!=typeof PerformanceTiming){let e={timing:(0,s.addPT)(n.originTime,n.globalScope.performance.timing,{},!0),navigation:(0,s.addPN)(n.globalScope.performance.navigation,{})};f.perf=(0,o.stringify)(e)}}f.fp=l.firstPaint.current.value,f.fcp=p.firstContentfulPaint.current.value;let u=this.agentRef.runtime.timeKeeper;u?.ready&&(f.timestamp=Math.floor(u.correctRelativeTimestamp((0,g.now)()))),this.rumStartTime=(0,g.now)(),this.agentRef.runtime.harvester.triggerHarvestFor(this,{directSend:{targetApp:t,payload:{qs:f,body:i}},needResponse:!0,sendEmptyBody:!0})}postHarvestCleanup({status:e,responseText:t,xhr:i,targetApp:r}){let n,s,o=(0,g.now)();try{({app:n,...s}=JSON.parse(t)),this.processEntities(n.agents,r)}catch(e){(0,d.warn)(53,e)}if((0,v.isContainerAgentTarget)(r,this.agentRef)){if(e>=400||0===e){(0,d.warn)(18,e),this.ee.abort();return}try{if(this.agentRef.runtime.timeKeeper.processRumRequest(i,this.rumStartTime,o,n.nrServerTime),!this.agentRef.runtime.timeKeeper.ready)throw Error("TimeKeeper not ready")}catch(e){this.ee.abort(),(0,d.warn)(17,e);return}Object.keys(this.agentRef.runtime.appMetadata).length||(this.agentRef.runtime.appMetadata=n),this.drain(),this.agentRef.runtime.harvester.startTimer(),(0,u.activateFeatures)(s,this.agentRef)}}processEntities(e,t){e&&t&&e.forEach(e=>{let i=this.agentRef.runtime.entityManager,r=e.entityGuid;i.get(r)||((0,v.isContainerAgentTarget)(t,this.agentRef)&&i.setDefaultEntity({...t,entityGuid:r}),i.set(e.entityGuid,{...t,entityGuid:r}))})}}}),i("6H82V",function(t,i){e(t.exports,"navTimingValues",function(){return d}),e(t.exports,"addPT",function(){return m}),e(t.exports,"addPN",function(){return p});var r="Start",n="unloadEvent",s="redirect",o="domainLookup",a="onnect",f="response",c="loadEvent",u="domContentLoadedEvent";let d=[];function m(e,t,i={},d=!1){if(t)return i.of=e,l(i.of,i,"n",!0),l(t[n+r],i,"u",d),l(t[s+r],i,"r",d),l(t[n+"End"],i,"ue",d),l(t[s+"End"],i,"re",d),l(t["fetch"+r],i,"f",d),l(t[o+r],i,"dn",d),l(t[o+"End"],i,"dne",d),l(t["c"+a+r],i,"c",d),l(t["secureC"+a+"ion"+r],i,"s",d),l(t["c"+a+"End"],i,"ce",d),l(t["request"+r],i,"rq",d),l(t[f+r],i,"rp",d),l(t[f+"End"],i,"rpe",d),l(t.domLoading,i,"dl",d),l(t.domInteractive,i,"di",d),l(t[u+r],i,"ds",d),l(t[u+"End"],i,"de",d),l(t.domComplete,i,"dc",d),l(t[c+r],i,"l",d),l(t[c+"End"],i,"le",d),i}function p(e,t){var i;return l("number"==typeof(i=e.type)?i:({navigate:void 0,reload:1,back_forward:2,prerender:3})[i],t,"ty"),l(e.redirectCount,t,"rc"),t}function l(e,t,i,r){"number"==typeof e&&e>0?(r&&(e=Math.max(e-(t?.of>0?t.of:0),0)),e=Math.round(e),t[i]=e,d.push(e)):d.push(void 0)}}),i("6cMq7",function(i,r){e(i.exports,"getActivatedFeaturesFlags",function(){return o});var n=t("gUmiN"),s=t("7jrqI");function o(e){let t=[],i=(0,s.gosNREUM)();try{Object.keys(i.initializedAgents[e].features).forEach(e=>{switch(e){case n.FEATURE_NAMES.ajax:t.push("xhr");break;case n.FEATURE_NAMES.jserrors:t.push("err");break;case n.FEATURE_NAMES.genericEvents:t.push("ins");break;case n.FEATURE_NAMES.sessionTrace:t.push("stn");break;case n.FEATURE_NAMES.softNav:case n.FEATURE_NAMES.spa:t.push("spa")}})}catch(e){}return t}}),i("hP1Bb",function(i,r){e(i.exports,"timeToFirstByte",function(){return f});var n=t("7CBaz"),s=t("bUgi3"),o=t("dmOjl"),a=t("kF4Tt");let f=new(0,o.VitalMetric)(s.VITAL_NAMES.TIME_TO_FIRST_BYTE);if(n.isBrowserScope&&"undefined"!=typeof PerformanceNavigationTiming&&!n.isiOS&&window===window.parent)(0,a.onTTFB)(({value:e,attribution:t})=>{f.isValid||f.update({value:e,attrs:{navigationEntry:t.navigationEntry}})});else if(!f.isValid){let e={};for(let t in n.globalScope?.performance?.timing||{})e[t]=Math.max(n.globalScope?.performance?.timing[t]-n.originTime,0);f.update({value:e.responseStart,attrs:{navigationEntry:e}})}}),i("jL9ao",function(i,r){e(i.exports,"TimeKeeper",function(){return s});var n=t("7CBaz");class s{#e;#t;#i;#r=!1;constructor(e){this.#e=e,this.processStoredDiff()}get ready(){return this.#r}get correctedOriginTime(){return this.#t}get localTimeDiff(){return this.#i}processRumRequest(e,t,i,r){if(this.processStoredDiff(),!this.#r){if(!r)throw Error("nrServerTime not found");if(this.#t=Math.floor(r-(t+(i-t)/2)),this.#i=n.originTime-this.#t,isNaN(this.#t))throw Error("Failed to correct browser time to server time");this.#e?.write({serverTimeDiff:this.#i}),this.#r=!0}}convertRelativeTimestamp(e){return n.originTime+e}convertAbsoluteTimestamp(e){return e-n.originTime}correctAbsoluteTimestamp(e){return e-this.#i}correctRelativeTimestamp(e){return this.correctAbsoluteTimestamp(this.convertRelativeTimestamp(e))}processStoredDiff(){if(this.#r)return;let e=this.#e?.read()?.serverTimeDiff;"number"!=typeof e||isNaN(e)||(this.#i=e,this.#t=n.originTime-this.#i,this.#r=!0)}}}),i("jHSql",function(t,i){e(t.exports,"applyFnToProps",function(){return function e(t,i,r="string",n=[]){return t&&"object"==typeof t&&Object.keys(t).forEach(s=>{"object"==typeof t[s]?e(t[s],i,r,n):typeof t[s]!==r||n.includes(s)||(t[s]=i(t[s]))}),t}})})}();
//# sourceMappingURL=aggregate.b7b32366.js.map

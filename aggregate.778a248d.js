function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire5e30,r=t.register;r("bIXwV",function(r,n){e(r.exports,"Aggregate",function(){return E});var a=t("7mEZo"),i=t("ea9x5"),s=t("encHy"),o=t("g3tfK"),c=t("4he1m"),u=t("8KO5M"),l=t("gy0pT"),f=t("9EKMI"),d=t("3o0w7"),h=t("3R40a"),g=t("3DmF0"),p=t("1Z3KE"),m=t("hcIxM"),b=t("aDNsY"),v=t("hzcK4"),S=t("jkuUu");class E extends g.AggregateBase{static featureName=d.FEATURE_NAME;constructor(e){super(e,d.FEATURE_NAME),this.stackReported={},this.observedAt={},this.pageviewReported={},this.bufferedErrorsUnderSpa={},this.errorOnPage=!1,this.ee.on("interactionDone",(e,t)=>this.onInteractionDone(e,t)),(0,c.registerHandler)("err",(...e)=>this.storeError(...e),this.featureName,this.ee),(0,c.registerHandler)("ierr",(...e)=>this.storeError(...e),this.featureName,this.ee),(0,c.registerHandler)("softNavFlush",(e,t,r)=>this.onSoftNavNotification(e,t,r),this.featureName,this.ee),this.harvestOpts.aggregatorTypes=["err","ierr","xhr"],this.waitForFlags(["err"]).then(([e])=>{e?this.drain():(this.blocked=!0,this.deregisterDrain())})}serializer(e){return(0,m.applyFnToProps)(e,this.obfuscator.obfuscateString.bind(this.obfuscator),"string")}queryStringsBuilder(e){let t={},r=(0,u.stringify)(this.agentRef.runtime.releaseIds);return"{}"!==r&&(t.ri=r),e?.err?.length&&(this.errorOnPage||(t.pve="1",this.errorOnPage=!0),this.agentRef.features?.[h.FEATURE_NAMES.sessionReplay]?.featAggregate?.replayIsActive()||e.err.forEach(e=>delete e.params.hasReplay)),t}buildCanonicalStackString(e){for(var t="",r=0;r<e.frames.length;r++){var n=e.frames[r],i=(0,a.canonicalFunctionName)(n.func);t&&(t+="\n"),i&&(t+=i+"@"),"string"==typeof n.url&&(t+=n.url),n.line&&(t+=":"+n.line)}return t}storeError(e,t,r,n,a,c,d){let g;if(!e)return;let m=this.agentRef.runtime.entityManager.get(d);if(!m)return(0,S.warn)(56,this.featureName);if(t=t||(0,p.now)(),!r&&this.agentRef.runtime.onerror&&(g=this.agentRef.runtime.onerror(e))&&!("string"==typeof g.group&&g.group.length))return;var E=(0,i.computeStackTrace)(e);let{shouldSwallow:y,reason:I}=(0,b.evaluateInternalError)(E,r,c);if(y)return void this.reportSupportabilityMetric("Internal/Error/"+I);var w=this.buildCanonicalStackString(E);let R={stackHash:(0,s.stringHashCode)(w),exceptionClass:E.name,request_uri:f.globalScope?.location.pathname};E.message&&(R.message=""+E.message),g?.group&&(R.errorGroup=g.group),a&&(0,v.isContainerAgentTarget)(m,this.agentRef)&&(R.hasReplay=a);var k=(0,s.stringHashCode)("".concat(E.name,"_").concat(E.message,"_").concat(E.stackString,"_").concat(+!!R.hasReplay));this.stackReported[k]?R.browser_stack_hash=(0,s.stringHashCode)(E.stackString):(this.stackReported[k]=!0,R.stack_trace=(0,o.truncateSize)(E.stackString),this.observedAt[k]=Math.floor(this.agentRef.runtime.timeKeeper.correctRelativeTimestamp(t))),R.releaseIds=(0,u.stringify)(this.agentRef.runtime.releaseIds),this.pageviewReported[k]||(R.pageview=1,this.pageviewReported[k]=!0),R.firstOccurrenceTimestamp=this.observedAt[k],R.timestamp=Math.floor(this.agentRef.runtime.timeKeeper.correctRelativeTimestamp(t));let _=["err",k,R,{time:t},n];this.shouldAllowMainAgentToCapture(d)&&(0,l.handle)("trace-jserror",_,void 0,h.FEATURE_NAMES.sessionTrace,this.ee),!this.blocked&&(e?.__newrelic?.[this.agentIdentifier]&&(R._interactionId=e.__newrelic[this.agentIdentifier].interactionId,R._interactionNodeId=e.__newrelic[this.agentIdentifier].interactionNodeId),this.shouldAllowMainAgentToCapture(d)&&(this.agentRef.features?.[h.FEATURE_NAMES.softNav]?(0,l.handle)("jserror",[R,t],void 0,h.FEATURE_NAMES.softNav,this.ee):(0,l.handle)("spa-jserror",_,void 0,h.FEATURE_NAMES.spa,this.ee),R.browserInteractionId&&!R._softNavFinished?(this.bufferedErrorsUnderSpa[R.browserInteractionId]??=[],this.bufferedErrorsUnderSpa[R.browserInteractionId].push(_)):null!=R._interactionId?(this.bufferedErrorsUnderSpa[R._interactionId]=this.bufferedErrorsUnderSpa[R._interactionId]||[],this.bufferedErrorsUnderSpa[R._interactionId].push(_)):this.#e(_,void 0!==R.browserInteractionId,R._softNavAttributes)),d&&this.#e([..._,d],!1,R._softNavAttributes))}#e(e,t,r={}){let[n,a,i,o,c,l]=e,f={};t?(Object.entries(r).forEach(([e,t])=>h(e,t)),a+=i.browserInteractionId,delete i._softNavAttributes,delete i._softNavFinished):(Object.entries(this.agentRef.info.jsAttributes).forEach(([e,t])=>h(e,t)),delete i.browserInteractionId),c&&Object.entries(c).forEach(([e,t])=>h(e,t));let d=a+":"+(0,s.stringHashCode)((0,u.stringify)(f));function h(e,t){f[e]=t&&"object"==typeof t?(0,u.stringify)(t):t}this.events.add([n,d,i,o,f],l)}shouldAllowMainAgentToCapture(e){return!e||this.agentRef.init.api.duplicate_registered_data}onInteractionDone(e,t){this.bufferedErrorsUnderSpa[e.id]&&!this.blocked&&(this.bufferedErrorsUnderSpa[e.id].forEach(r=>{var n={};let a=r[4];Object.entries(e.root.attrs.custom||{}).forEach(l),Object.entries(a||{}).forEach(l);var i=r[2];t&&(i.browserInteractionId=e.root.attrs.id,i._interactionNodeId&&(i.parentNodeId=i._interactionNodeId.toString())),delete i._interactionId,delete i._interactionNodeId;var o=t?r[1]+e.root.attrs.id:r[1],c=(0,s.stringHashCode)((0,u.stringify)(n));function l([e,t]){n[e]=t&&"object"==typeof t?(0,u.stringify)(t):t}this.events.add([r[0],o+":"+c,i,r[3],n],r[5])}),delete this.bufferedErrorsUnderSpa[e.id])}onSoftNavNotification(e,t,r){this.blocked||(this.bufferedErrorsUnderSpa[e]?.forEach(e=>this.#e(e,t,r)),delete this.bufferedErrorsUnderSpa[e])}}}),r("7mEZo",function(t,r){e(t.exports,"canonicalFunctionName",function(){return a});let n=/([a-z0-9]+)$/i;function a(e){if(!e)return;let t=e.match(n);if(t)return t[1]}}),r("ea9x5",function(r,n){e(r.exports,"computeStackTrace",function(){return f});var a=t("g3tfK"),i=t("kB7pt"),s=/function (.+?)\s*\(/,o=/^\s*at (?:((?:\[object object\])?(?:[^(]*\([^)]*\))*[^()]*(?: \[as \S+\])?) )?\(?((?:file|http|https|chrome-extension):.*?)?:(\d+)(?::(\d+))?\)?\s*$/i,c=/^\s*(?:(\S*|global code)(?:\(.*?\))?@)?((?:file|http|https|chrome|safari-extension).*?):(\d+)(?::(\d+))?\s*$/i,u=/^\s*at .+ \(eval at \S+ \((?:(?:file|http|https):[^)]+)?\)(?:, [^:]*:\d+:\d+)?\)$/i,l=/^\s*at Function code \(Function code:\d+:\d+\)\s*/i;function f(e){var t,r,n=null;try{if(n=function(e){if(!e.stack)return null;var t=e.stack.split("\n").reduce(d,{frames:[],stackLines:[],wrapperSeen:!1});return t.frames.length?{mode:"stack",name:e.name||h(e),message:e.message,stackString:(0,a.formatStackTrace)(t.stackLines),frames:t.frames}:null}(e))return n}catch(e){}try{if(n=function(e){if(!("line"in e))return null;var t=e.name||h(e);if(!e.sourceURL)return{mode:"sourceline",name:t,message:e.message,stackString:t+": "+e.message+"\n    in evaluated code",frames:[{func:"evaluated code"}]};var r=(0,i.canonicalizeUrl)(e.sourceURL),n=t+": "+e.message+"\n    at "+r;return e.line&&(n+=":"+e.line,e.column&&(n+=":"+e.column)),{mode:"sourceline",name:t,message:e.message,stackString:n,frames:[{url:r,line:e.line,column:e.column}]}}(e))return n}catch(e){}try{if(n=(r=(t=e).name||h(t))?{mode:"nameonly",name:r,message:t.message,stackString:r+": "+t.message,frames:[]}:null)return n}catch(e){}return{mode:"failed",stackString:"",frames:[]}}function d(e,t){var r,n,a;let s=((n=(r=t).match(c))||(n=r.match(o)),n)?{url:n[2],func:"Anonymous function"!==n[1]&&"global code"!==n[1]&&n[1]||null,line:+n[3],column:n[4]?+n[4]:null}:r.match(u)||r.match(l)||"anonymous"===r?{func:"evaluated code"}:void 0;if(!s)return e.stackLines.push(t),e;if((a=s.func)&&a.indexOf("nrWrapper")>=0&&(e.wrapperSeen=!0),!e.wrapperSeen){let r=(0,i.canonicalizeUrl)(s.url);r!==s.url&&(t=t.replace(s.url,r),s.url=r),e.stackLines.push(t),e.frames.push(s)}return e}function h(e){var t=s.exec(String(e.constructor));return t&&t.length>1?t[1]:"unknown"}}),r("g3tfK",function(t,r){e(t.exports,"formatStackTrace",function(){return a}),e(t.exports,"truncateSize",function(){return i});var n=/^\n+|\n+$/g;function a(e){return(function(e){var t;if(e.length>100){var r=e.length-100;t=e.slice(0,50).join("\n")+("\n< ...truncated "+r)+" lines... >\n"+e.slice(-50).join("\n")}else t=e.join("\n");return t})(e).replace(n,"")}function i(e){return e.length>65530?e.substr(0,65530):e}}),r("kB7pt",function(r,n){e(r.exports,"canonicalizeUrl",function(){return s});var a=t("9EKMI"),i=t("jWywI");function s(e){if("string"!=typeof e)return"";let t=(0,i.cleanURL)(e);return t===(0,i.cleanURL)(a.initialLocation)?"<inline>":t}}),r("encHy",function(t,r){e(t.exports,"stringHashCode",function(){return n});function n(e){var t=0;if(!e||!e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return t}}),r("hcIxM",function(t,r){e(t.exports,"applyFnToProps",function(){return function e(t,r,n="string",a=[]){return t&&"object"==typeof t&&Object.keys(t).forEach(i=>{"object"==typeof t[i]?e(t[i],r,n,a):typeof t[i]!==n||a.includes(i)||(t[i]=r(t[i]))}),t}})}),r("aDNsY",function(t,r){e(t.exports,"evaluateInternalError",function(){return i});let n="Rrweb",a="Security-Policy";function i(e,t,r){let i={shouldSwallow:t||!1,reason:r||"Other"},s=e.frames?.[0];if(!s||"string"!=typeof e?.message)return i;let o=s?.url?.match(/nr-(.*)-recorder.min.js/),c=s?.url?.match(/rrweb/),u=s?.url?.match(/recorder/),l=e.message.toLowerCase().match(/an attempt was made to break through the security policy of the user agent/);return o||c?(i.shouldSwallow=!0,i.reason=n,l&&(i.reason+="-"+a)):u&&l&&(i.shouldSwallow=!0,i.reason=n+"-"+a),i}});
//# sourceMappingURL=aggregate.778a248d.js.map

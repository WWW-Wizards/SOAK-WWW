function t(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,enumerable:!0,configurable:!0})}var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire5e30,i=e.register;i("bEFXe",function(i,n){t(i.exports,"Aggregate",function(){return m});var s=e("gy0pT"),r=e("4he1m"),a=e("letnH"),o=e("kkmY2"),c=e("3R40a"),u=e("3DmF0"),h=e("1ZAXp"),l=e("gtRNT"),d=e("l3aTe"),f=e("jStS4");class m extends u.AggregateBase{static featureName=h.FEATURE_NAME;constructor(t,{domObserver:e}){super(t,h.FEATURE_NAME),this.interactionsToHarvest=this.events,this.domObserver=e,this.initialPageLoadInteraction=new(0,d.InitialPageLoadInteraction)(t),this.initialPageLoadInteraction.onDone.push(()=>{t.runtime.session?.isNew&&(this.initialPageLoadInteraction.customAttributes.isFirstOfSession=!0),this.initialPageLoadInteraction.forceSave=!0;let e=this.initialPageLoadInteraction;this.interactionsToHarvest.add(e),this.initialPageLoadInteraction=null}),o.timeToFirstByte.subscribe(({attrs:t})=>{let e=t.navigationEntry.loadEventEnd;this.initialPageLoadInteraction.done(e),this.reportSupportabilityMetric("SoftNav/Interaction/InitialPageLoad/Duration/Ms",Math.round(e))}),this.latestRouteSetByApi=null,this.interactionInProgress=null,this.latestHistoryUrl=null,this.harvestOpts.beforeUnload=()=>this.interactionInProgress?.done(),this.waitForFlags(["spa"]).then(([e])=>{e?(this.drain(),setTimeout(()=>t.runtime.harvester.triggerHarvestFor(this),0)):(this.blocked=!0,this.deregisterDrain())}),(0,r.registerHandler)("newUIEvent",t=>this.startUIInteraction(t.type,Math.floor(t.timeStamp),t.target),this.featureName,this.ee),(0,r.registerHandler)("newURL",(t,e)=>{this.latestHistoryUrl=e,this.interactionInProgress?.updateHistory(t,e)},this.featureName,this.ee),(0,r.registerHandler)("newDom",t=>{this.interactionInProgress?.updateDom(t),this.interactionInProgress?.seenHistoryAndDomChange()&&this.interactionInProgress.done()},this.featureName,this.ee),this.#t(),(0,r.registerHandler)("ajax",this.#e.bind(this),this.featureName,this.ee),(0,r.registerHandler)("jserror",this.#i.bind(this),this.featureName,this.ee)}serializer(t){let e,i=[];for(let n of t)i.push(n.serialize(e)),void 0===e&&(e=Math.floor(n.start));return"bel.7;".concat(i.join(";"))}startUIInteraction(t,e,i){if(this.interactionInProgress?.createdByApi||this.interactionInProgress?.done()===!1)return;let n=t===h.INTERACTION_TRIGGERS[3]?this.latestHistoryUrl:void 0;if(this.interactionInProgress=new(0,f.Interaction)(this.agentRef,t,e,this.latestRouteSetByApi,n),t===h.INTERACTION_TRIGGERS[0]){let t=function(t){if(["a","button","input"].includes(t.tagName.toLowerCase()))return t.title||t.value||t.innerText}(i);t&&(this.interactionInProgress.customAttributes.actionText=t)}this.interactionInProgress.cancellationTimer=setTimeout(()=>{this.interactionInProgress.done(),this.reportSupportabilityMetric("SoftNav/Interaction/TimeOut")},3e4),this.setClosureHandlers()}setClosureHandlers(){this.interactionInProgress.on("finished",()=>{let t=this.interactionInProgress;this.interactionsToHarvest.add(this.interactionInProgress),this.interactionInProgress=null,this.domObserver.disconnect(),this.reportSupportabilityMetric("SoftNav/Interaction/".concat(t.newURL!==t.oldURL?"RouteChange":"Custom","/Duration/Ms"),Math.round(t.end-t.start))}),this.interactionInProgress.on("cancelled",()=>{this.interactionInProgress=null,this.domObserver.disconnect()})}getInteractionFor(t){let e;if(this.interactionInProgress?.isActiveDuring(t))return this.interactionInProgress;let[{data:i}]=this.interactionsToHarvest.get();for(let n=i.length-1;n>=0;n--){let s=i[n];if(s.isActiveDuring(t))if(s.trigger!==h.IPL_TRIGGER_NAME)return s;else e=s}return e||(this.initialPageLoadInteraction?.isActiveDuring(t)?this.initialPageLoadInteraction:void 0)}#e(t){let e=this.getInteractionFor(t.startTime);function i(t,e,i){let n=new(0,l.AjaxNode)(t,e);i.addChild(n)}e?e.status===h.INTERACTION_STATUS.FIN?i(this.agentRef,t,e):(e.on("finished",()=>i(this.agentRef,t,e)),e.on("cancelled",()=>(0,s.handle)("returnAjax",[t],void 0,c.FEATURE_NAMES.ajax,this.ee))):(0,s.handle)("returnAjax",[t],void 0,c.FEATURE_NAMES.ajax,this.ee)}#i(t,e){let i=this.getInteractionFor(e);i&&(t.browserInteractionId=i.id,i.status===h.INTERACTION_STATUS.FIN?(t._softNavFinished=!0,t._softNavAttributes=i.customAttributes):(i.on("finished",(0,a.single)(()=>(0,s.handle)("softNavFlush",[i.id,!0,i.customAttributes],void 0,c.FEATURE_NAMES.jserrors,this.ee))),i.on("cancelled",(0,a.single)(()=>(0,s.handle)("softNavFlush",[i.id,!1,void 0],void 0,c.FEATURE_NAMES.jserrors,this.ee)))))}#t(){let t="api-ixn-",e=this;(0,r.registerHandler)(t+"get",function(t,{waitForEnd:i}={}){this.associatedInteraction=e.getInteractionFor(t),this.associatedInteraction?.trigger===h.IPL_TRIGGER_NAME&&(this.associatedInteraction=null),this.associatedInteraction||(this.associatedInteraction=e.interactionInProgress=new(0,f.Interaction)(e.agentRef,h.API_TRIGGER_NAME,t,e.latestRouteSetByApi),e.domObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),e.setClosureHandlers()),!0===i&&(this.associatedInteraction.keepOpenUntilEndApi=!0)},e.featureName,e.ee),(0,r.registerHandler)(t+"end",function(t){this.associatedInteraction.done(t)},e.featureName,e.ee),(0,r.registerHandler)(t+"save",function(){this.associatedInteraction.forceSave=!0},e.featureName,e.ee),(0,r.registerHandler)(t+"ignore",function(){this.associatedInteraction.forceIgnore=!0},e.featureName,e.ee),(0,r.registerHandler)(t+"getContext",function(t,e){"function"==typeof e&&setTimeout(()=>e(this.associatedInteraction.customDataByApi),0)},e.featureName,e.ee),(0,r.registerHandler)(t+"onEnd",function(t,e){"function"==typeof e&&this.associatedInteraction.onDone.push(e)},e.featureName,e.ee),(0,r.registerHandler)(t+"actionText",function(t,e){e&&(this.associatedInteraction.customAttributes.actionText=e)},e.featureName,e.ee),(0,r.registerHandler)(t+"setName",function(t,e,i){e&&(this.associatedInteraction.customName=e),i&&(this.associatedInteraction.trigger=i)},e.featureName,e.ee),(0,r.registerHandler)(t+"setAttribute",function(t,e,i){this.associatedInteraction.customAttributes[e]=i},e.featureName,e.ee),(0,r.registerHandler)(t+"routeName",function(t,i){e.latestRouteSetByApi=i,e.interactionInProgress&&(e.interactionInProgress.newRoute=i)},e.featureName,e.ee)}}}),i("kkmY2",function(i,n){t(i.exports,"timeToFirstByte",function(){return c});var s=e("9EKMI"),r=e("dYojd"),a=e("bDCBv"),o=e("8683F");let c=new(0,a.VitalMetric)(r.VITAL_NAMES.TIME_TO_FIRST_BYTE);if(s.isBrowserScope&&"undefined"!=typeof PerformanceNavigationTiming&&!s.isiOS&&window===window.parent)(0,o.onTTFB)(({value:t,attribution:e})=>{c.isValid||c.update({value:t,attrs:{navigationEntry:e.navigationEntry}})});else if(!c.isValid){let t={};for(let e in s.globalScope?.performance?.timing||{})t[e]=Math.max(s.globalScope?.performance?.timing[e]-s.originTime,0);c.update({value:t.responseStart,attrs:{navigationEntry:t}})}}),i("gtRNT",function(i,n){t(i.exports,"AjaxNode",function(){return o});var s=e("ewyxt"),r=e("1ZAXp"),a=e("525mw");class o extends a.BelNode{constructor(t,e){super(t),this.belType=r.NODE_TYPE.AJAX,this.method=e.method,this.status=e.status,this.domain=e.domain,this.path=e.path,this.txSize=e.requestSize,this.rxSize=e.responseSize,this.requestedWith="fetch"===e.type?1:"",this.spanId=e.spanId,this.traceId=e.traceId,this.spanTimestamp=e.spanTimestamp,this.gql=e.gql,this.start=e.startTime,this.end=e.endTime}serialize(t){let e=(0,s.getAddStringContext)(this.obfuscator),i=[],n=[(0,s.numeric)(this.belType),0,(0,s.numeric)(this.start-t),(0,s.numeric)(this.end-this.start),(0,s.numeric)(this.callbackEnd),(0,s.numeric)(this.callbackDuration),e(this.method),(0,s.numeric)(this.status),e(this.domain),e(this.path),(0,s.numeric)(this.txSize),(0,s.numeric)(this.rxSize),this.requestedWith,e(this.nodeId),(0,s.nullable)(this.spanId,e,!0)+(0,s.nullable)(this.traceId,e,!0)+(0,s.nullable)(this.spanTimestamp,s.numeric)],r=[];return"object"==typeof this.gql&&(r=(0,s.addCustomAttributes)(this.gql,e)),this.children.forEach(t=>r.push(t.serialize())),n[1]=(0,s.numeric)(r.length),i.push(n),r.length&&i.push(r.join(";")),i.join(";")}}}),i("ewyxt",function(i,n){t(i.exports,"nullable",function(){return a}),t(i.exports,"numeric",function(){return o}),t(i.exports,"getAddStringContext",function(){return c}),t(i.exports,"addCustomAttributes",function(){return u});var s=e("8KO5M"),r=Object.prototype.hasOwnProperty;function a(t,e,i){return t||0===t||""===t?e(t)+(i?",":""):"!"}function o(t,e){return e?Math.floor(t).toString(36):void 0===t||0===t?"":Math.floor(t).toString(36)}function c(t){let e=0,i=Object.prototype.hasOwnProperty.call(Object,"create")?Object.create(null):{};return function(n){return void 0===n||""===n?"":(n=t.obfuscateString(String(n)),r.call(i,n))?o(i[n],!0):(i[n]=e++,"'"+n.replace(h,"\\$1"))}}function u(t,e){var i=[];return Object.entries(t||{}).forEach(([t,n])=>{if(!(i.length>=64)){var r,a=5;switch(t=e(t),typeof n){case"object":n?r=e((0,s.stringify)(n)):a=9;break;case"number":a=6,r=n%1?n:n+".";break;case"boolean":a=n?7:8;break;case"undefined":a=9;break;default:r=e(n)}i.push([a,t+(r?","+r:"")])}}),i}var h=/([,\\;])/g}),i("525mw",function(e,i){t(e.exports,"BelNode",function(){return s});let n=0;class s{belType;children=[];start;end;callbackEnd=0;callbackDuration=0;nodeId=++n;constructor(t){this.obfuscator=t.runtime.obfuscator,this.info=t.info}addChild(t){this.children.push(t)}serialize(){}}}),i("l3aTe",function(i,n){t(i.exports,"InitialPageLoadInteraction",function(){return h});var s=e("8aXHb"),r=e("jStS4"),a=e("ewyxt"),o=e("gDw2s"),c=e("ifld8"),u=e("1ZAXp");class h extends r.Interaction{constructor(t){super(t,u.IPL_TRIGGER_NAME,0,null),this.queueTime=t.info.queueTime,this.appTime=t.info.applicationTime}get firstPaint(){return o.firstPaint.current.value}get firstContentfulPaint(){return c.firstContentfulPaint.current.value}get navTiming(){if(!s.navTimingValues.length)return;let t=",",e="b",i=0;return s.navTimingValues.slice(1,21).forEach(n=>{void 0!==n?(e+=t+(0,a.numeric)(n-i),t=",",i=n):(e+=t+"!",t="")}),e}}}),i("8aXHb",function(e,i){t(e.exports,"navTimingValues",function(){return l}),t(e.exports,"addPT",function(){return d}),t(e.exports,"addPN",function(){return f});var n="Start",s="unloadEvent",r="redirect",a="domainLookup",o="onnect",c="response",u="loadEvent",h="domContentLoadedEvent";let l=[];function d(t,e,i={},l=!1){if(e)return i.of=t,m(i.of,i,"n",!0),m(e[s+n],i,"u",l),m(e[r+n],i,"r",l),m(e[s+"End"],i,"ue",l),m(e[r+"End"],i,"re",l),m(e["fetch"+n],i,"f",l),m(e[a+n],i,"dn",l),m(e[a+"End"],i,"dne",l),m(e["c"+o+n],i,"c",l),m(e["secureC"+o+"ion"+n],i,"s",l),m(e["c"+o+"End"],i,"ce",l),m(e["request"+n],i,"rq",l),m(e[c+n],i,"rp",l),m(e[c+"End"],i,"rpe",l),m(e.domLoading,i,"dl",l),m(e.domInteractive,i,"di",l),m(e[h+n],i,"ds",l),m(e[h+"End"],i,"de",l),m(e.domComplete,i,"dc",l),m(e[u+n],i,"l",l),m(e[u+"End"],i,"le",l),i}function f(t,e){var i;return m("number"==typeof(i=t.type)?i:({navigate:void 0,reload:1,back_forward:2,prerender:3})[i],e,"ty"),m(t.redirectCount,e,"rc"),e}function m(t,e,i,n){"number"==typeof t&&t>0?(n&&(t=Math.max(t-(e?.of>0?e.of:0),0)),t=Math.round(t),e[i]=t,l.push(t)):l.push(void 0)}}),i("jStS4",function(i,n){t(i.exports,"Interaction",function(){return l});var s=e("9EKMI"),r=e("6sT7C"),a=e("ewyxt"),o=e("1Z3KE"),c=e("jWywI"),u=e("1ZAXp"),h=e("525mw");class l extends h.BelNode{id=(0,r.generateUuid)();initialPageURL=s.initialLocation;customName;customAttributes={};customDataByApi={};queueTime;appTime;newRoute;status=u.INTERACTION_STATUS.IP;domTimestamp=0;historyTimestamp=0;createdByApi=!1;keepOpenUntilEndApi=!1;onDone=[];cancellationTimer;constructor(t,e,i,n,r){super(t),this.belType=u.NODE_TYPE.INTERACTION,this.trigger=e,this.start=i,this.oldRoute=n,this.eventSubscription=new Map([["finished",[]],["cancelled",[]]]),this.forceSave=this.forceIgnore=!1,this.trigger===u.API_TRIGGER_NAME&&(this.createdByApi=!0),this.newURL=this.oldURL=r||s.globalScope?.location.href}updateDom(t){this.domTimestamp=t||(0,o.now)()}updateHistory(t,e){this.newURL=e||""+s.globalScope?.location,this.historyTimestamp=t||(0,o.now)()}seenHistoryAndDomChange(){return this.historyTimestamp>0&&this.domTimestamp>this.historyTimestamp}on(t,e){if(!this.eventSubscription.has(t))throw Error("Cannot subscribe to non pre-defined events.");if("function"!=typeof e)throw Error("Must supply function as callback.");this.eventSubscription.get(t).push(e)}done(t){return(!this.keepOpenUntilEndApi||void 0!==t)&&(this.status!==u.INTERACTION_STATUS.IP||(this.onDone.forEach(t=>t(this.customDataByApi)),this.forceIgnore?this.#n():this.seenHistoryAndDomChange()?this.#s(t):this.forceSave?this.#s(t||performance.now()):this.#n(),!0))}#s(t=0){clearTimeout(this.cancellationTimer),this.end=Math.max(this.domTimestamp,this.historyTimestamp,t),this.customAttributes={...this.info.jsAttributes,...this.customAttributes},this.status=u.INTERACTION_STATUS.FIN,this.eventSubscription.get("finished").forEach(t=>t())}#n(){clearTimeout(this.cancellationTimer),this.status=u.INTERACTION_STATUS.CAN,this.eventSubscription.get("cancelled").forEach(t=>t())}isActiveDuring(t){return this.status===u.INTERACTION_STATUS.IP?this.start<=t:this.status===u.INTERACTION_STATUS.FIN&&this.start<=t&&this.end>t}get firstPaint(){}get firstContentfulPaint(){}get navTiming(){}serialize(t){let e,i=void 0===t,n=(0,a.getAddStringContext)(this.obfuscator),s=[];e=this.trigger===u.IPL_TRIGGER_NAME?u.INTERACTION_TYPE.INITIAL_PAGE_LOAD:this.newURL!==this.oldURL?u.INTERACTION_TYPE.ROUTE_CHANGE:u.INTERACTION_TYPE.UNSPECIFIED;let r=[(0,a.numeric)(this.belType),0,(0,a.numeric)(this.start-(i?0:t)),(0,a.numeric)(this.end-this.start),(0,a.numeric)(this.callbackEnd),(0,a.numeric)(this.callbackDuration),n(this.trigger),n((0,c.cleanURL)(this.initialPageURL,!0)),n((0,c.cleanURL)(this.oldURL,!0)),n((0,c.cleanURL)(this.newURL,!0)),n(this.customName),e,(0,a.nullable)(this.queueTime,a.numeric,!0)+(0,a.nullable)(this.appTime,a.numeric,!0)+(0,a.nullable)(this.oldRoute,n,!0)+(0,a.nullable)(this.newRoute,n,!0)+n(this.id),n(this.nodeId),(0,a.nullable)(this.firstPaint,a.numeric,!0)+(0,a.nullable)(this.firstContentfulPaint,a.numeric)],o=(0,a.addCustomAttributes)(this.customAttributes||{},n);return this.info.atts&&o.push("a,"+n(this.info.atts)),this.children.forEach(e=>o.push(e.serialize(i?this.start:t))),r[1]=(0,a.numeric)(o.length),s.push(r),o.length&&s.push(o.join(";")),this.navTiming?s.push(this.navTiming):s.push(""),s.join(";")}}});
//# sourceMappingURL=aggregate.34b20a32.js.map

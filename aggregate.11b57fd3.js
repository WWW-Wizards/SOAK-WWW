function e(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire5e30,r=t.register;r("3DmF0",function(r,a){e(r.exports,"AggregateBase",function(){return S});var i=t("1017n"),n=t("4RLGm"),s=t("8ncaL"),o=t("juL0p"),u=t("Sqjfb"),c=t("kdrxV"),g=t("1k92u"),h=t("3R40a"),l=t("51Ndk"),p=t("bpra8"),f=t("jkuUu"),d=t("9h4E6"),y=t("8fPf9"),v=t("gy0pT"),m=t("bu0p3"),E=t("6ShzS");class S extends i.FeatureBase{constructor(e,t){super(e.agentIdentifier,t),this.agentRef=e,this.checkConfiguration(e),this.doOnceForAllAggregate(e),this.harvestOpts={};let r=this.agentRef?.runtime?.appMetadata?.agents?.[0]?.entityGuid;this.#e(r),r||this.ee.on("entity-added",e=>{this.events?.setEventStore?.(e.entityGuid)})}#e(e){if(!this.events)switch(this.featureName){case h.FEATURE_NAMES.sessionTrace:case h.FEATURE_NAMES.sessionReplay:break;case h.FEATURE_NAMES.jserrors:case h.FEATURE_NAMES.metrics:this.events=this.agentRef.sharedAggregator??=new(0,l.EventStoreManager)(this.agentRef,E.EventAggregator,e,"shared_aggregator");break;default:this.events=new(0,l.EventStoreManager)(this.agentRef,y.EventBuffer,e,this.featureName)}}waitForFlags(e=[]){return new Promise((t,r)=>{c.activatedFeatures[this.agentIdentifier]?t(a(c.activatedFeatures[this.agentIdentifier])):this.ee.on("rumresp",(e={})=>{t(a(e))});function a(t){return e.map(e=>t[e]?t[e]:0)}}).catch(e=>{this.ee.emit("internal-error",[e]),this.blocked=!0,this.deregisterDrain()})}drain(){(0,u.drain)(this.agentIdentifier,this.featureName),this.drained=!0}preHarvestChecks(e){return!this.blocked}makeHarvestPayload(e=!1,t={}){if(!this.events||this.events.isEmpty(this.harvestOpts,t.targetEntityGuid)||this.preHarvestChecks&&!this.preHarvestChecks(t))return;e&&this.events.save(this.harvestOpts,t.targetEntityGuid);let r=this.events.get(this.harvestOpts,t.targetEntityGuid);return r.length?(this.events.clear(this.harvestOpts,t.targetEntityGuid),r.map(({targetApp:e,data:t})=>{let r={body:this.serializer?this.serializer(t,e?.entityGuid):t};return this.queryStringsBuilder&&(r.qs=this.queryStringsBuilder(t,e?.entityGuid)),{targetApp:e,payload:r}})):(0,f.warn)(52)}postHarvestCleanup(e={}){e.sent&&e.retry&&this.events.reloadSave(this.harvestOpts,e.targetApp?.entityGuid),this.events.clearSave(this.harvestOpts,e.targetApp?.entityGuid)}checkConfiguration(e){if(!(0,n.isValid)(e.info)){let t=(0,o.gosCDN)(),r={...t.info?.jsAttributes};try{r={...r,...e.info?.jsAttributes}}catch(e){}(0,s.configure)(e,{...t,info:{...t.info,jsAttributes:r},runtime:e.runtime},e.runtime.loaderType)}}doOnceForAllAggregate(e){e.runtime.obfuscator||(e.runtime.obfuscator=new(0,g.Obfuscator)(e)),this.obfuscator=e.runtime.obfuscator,e.runtime.entityManager||(e.runtime.entityManager=new(0,d.EntityManager)(this.agentRef)),e.runtime.harvester||(e.runtime.harvester=new(0,p.Harvester)(e))}reportSupportabilityMetric(e,t){(0,v.handle)(m.SUPPORTABILITY_METRIC_CHANNEL,[e,t],void 0,h.FEATURE_NAMES.metrics,this.ee)}}}),r("1k92u",function(r,a){e(r.exports,"Obfuscator",function(){return s});var i=t("ayINm"),n=t("jkuUu");class s{constructor(e){this.agentRef=e,this.warnedRegexMissing=!1,this.warnedInvalidRegex=!1,this.warnedInvalidReplacement=!1}get obfuscateConfigRules(){return this.agentRef.init.obfuscate||[]}obfuscateString(e){if("string"!=typeof e||0===e.trim().length)return e;let t=this.obfuscateConfigRules.map(e=>this.validateObfuscationRule(e));return(0,i.isFileProtocol)()&&t.push({regex:/^file:\/\/(.*)/,replacement:atob("ZmlsZTovL09CRlVTQ0FURUQ=")}),t.filter(e=>e.isValid).reduce((e,t)=>{let{rule:r}=t;return e.replace(r.regex,r.replacement||"*")},e)}validateObfuscationRule(e){let t=void 0===e.regex,r=!(void 0===e.regex||"string"==typeof e.regex||e.regex instanceof RegExp),a=!!(e.replacement&&"string"!=typeof e.replacement);return t&&!this.warnedRegexMissing?((0,n.warn)(12,e),this.warnedRegexMissing=!0):r&&!this.warnedInvalidRegex&&((0,n.warn)(13,e),this.warnedInvalidRegex=!0),a&&!this.warnedInvalidReplacement&&((0,n.warn)(14,e),this.warnedInvalidReplacement=!0),{rule:e,isValid:!t&&!r&&!a,errors:{regexMissingDetected:t,invalidRegexDetected:r,invalidReplacementDetected:a}}}}}),r("ayINm",function(r,a){e(r.exports,"isFileProtocol",function(){return n});var i=t("9EKMI");function n(){return i.globalScope?.location?.protocol==="file:"}}),r("51Ndk",function(r,a){e(r.exports,"EventStoreManager",function(){return u});var i=t("klTus"),n=t("kdrxV"),s=t("hzcK4");let o="NR_CONTAINER_AGENT";class u{constructor(e,t,r,a){this.agentRef=e,this.entityManager=e.runtime.entityManager,this.StorageClass=t,this.appStorageMap=new Map([[o,new this.StorageClass]]),this.featureName=a,this.setEventStore(r)}#t(e=o){return this.appStorageMap.has(e)||this.setEventStore(e),this.appStorageMap.get(e)}setEventStore(e){if(!e)return;let t=(0,s.isContainerAgentTarget)(this.entityManager.get(e),this.agentRef)?this.appStorageMap.get(o):new this.StorageClass;this.appStorageMap.set(e,t)}isEmpty(e,t){if(t)return this.#t(t).isEmpty(e);for(let t of this.appStorageMap.values())if(!t.isEmpty(e))return!1;return!0}add(e,t){return(0,i.dispatchGlobalEvent)({agentIdentifier:this.agentRef.agentIdentifier,drained:!!n.activatedFeatures?.[this.agentRef.agentIdentifier],type:"data",name:"buffer",feature:this.featureName,data:e}),this.#t(t).add(e)}addMetric(e,t,r,a){return this.#t().addMetric(e,t,r,a)}get(e,t){if(t)return[{targetApp:this.entityManager.get(t),data:this.#t(t).get(e)}];let r=[];return this.appStorageMap.forEach((t,a)=>{let i=this.entityManager.get(a);i&&r.push({targetApp:i,data:t.get(e)})}),r}byteSize(e){return this.#t(e).byteSize()}wouldExceedMaxSize(e,t){return this.#t(t).wouldExceedMaxSize(e)}save(e,t){if(t)return this.#t(t).save(e);this.appStorageMap.forEach(t=>t.save(e))}clear(e,t){if(t)return this.#t(t).clear(e);this.appStorageMap.forEach(t=>t.clear(e))}reloadSave(e,t){return this.#t(t).reloadSave(e)}clearSave(e,t){return this.#t(t).clearSave(e)}}}),r("bpra8",function(r,a){e(r.exports,"Harvester",function(){return S});var i=t("bu0p3"),n=t("3R40a"),s=t("4wUr4"),o=t("9EKMI"),u=t("gy0pT"),c=t("8FJov"),g=t("44Lnf"),h=t("1Z3KE"),l=t("6Wy66"),p=t("jWywI"),f=t("ikySP"),d=t("jkuUu"),y=t("8KO5M"),v=t("21aPu"),m=t("kdrxV"),E=t("klTus");class S{#r=!1;initializedAggregates=[];constructor(e){this.agentRef=e,(0,l.subscribeToEOL)(()=>{this.initializedAggregates.forEach(e=>{"function"==typeof e.harvestOpts.beforeUnload&&e.harvestOpts.beforeUnload()}),this.initializedAggregates.forEach(e=>this.triggerHarvestFor(e,{isFinalHarvest:!0}))},!1),e.ee.on(g.SESSION_EVENTS.RESET,()=>this.initializedAggregates.forEach(e=>this.triggerHarvestFor(e,{forceNoRetry:!0})))}startTimer(e=this.agentRef.init.harvest.interval){if(this.#r)return;this.#r=!0;let t=()=>{this.initializedAggregates.forEach(e=>this.triggerHarvestFor(e)),setTimeout(t,1e3*e)};setTimeout(t,1e3*e)}triggerHarvestFor(e,t={}){let r;if(e.blocked)return!1;let a=(0,v.getSubmitMethod)(t);if(!a)return!1;let g=!t.isFinalHarvest&&a===v.xhr,l=!1;if(t.directSend)r=[t.directSend];else if(!(r=e.makeHarvestPayload(g,t)))return!1;return r.forEach(({targetApp:r,payload:i})=>{i&&(function(e,{endpoint:t,targetApp:r,payload:a,localOpts:i={},submitMethod:u,cbFinished:g,raw:l,featureName:S}){if(!e.info.errorBeacon)return;let{body:k,qs:A}=function(e={}){let t=e=>"undefined"!=typeof Uint8Array&&e instanceof Uint8Array||Array.isArray(e)?e:"string"==typeof e?e.length>0?e:null:Object.entries(e||{}).reduce((e,[t,r])=>(("number"==typeof r||"string"==typeof r&&r.length>0||"object"==typeof r&&Object.keys(r||{}).length>0)&&(e[t]=r),e),{});return{body:t(e.body),qs:t(e.qs)}}(a);if(0===Object.keys(k).length&&!i.sendEmptyBody)return g&&g({sent:!1,targetApp:r});let x=!1===e.init.ssl?"http":"https",R=e.init.proxy.beacon||e.info.errorBeacon,w=l?"".concat(x,"://").concat(R,"/").concat(t):"".concat(x,"://").concat(R).concat(t!==n.RUM?"/"+t:"","/1/").concat(r.licenseKey),M=l?"":function(e,t,r,a){let i=e.runtime.obfuscator.obfuscateString((0,p.cleanURL)(""+o.globalScope.location)),u=e.runtime.session?.state.sessionReplayMode===1&&r!==n.JSERRORS,c=e.runtime.session?.state.sessionTraceMode===1&&![n.LOGS,n.BLOBS].includes(r),g=["a="+a,(0,f.param)("sa",e.info.sa?""+e.info.sa:""),(0,f.param)("v",s.VERSION),e.info.transactionName?(0,f.param)("to",e.info.transactionName):(0,f.param)("t",e.info.tNamePlain||"Unnamed Transaction"),(0,f.param)("ct",e.runtime.customTransaction),"&rst="+(0,h.now)(),"&ck=0","&s="+(e.runtime.session?.state.value||"0"),(0,f.param)("ref",i),(0,f.param)("ptid",e.runtime.ptid?""+e.runtime.ptid:"")];return u&&g.push((0,f.param)("hr","1",t)),c&&g.push((0,f.param)("ht","1",t)),g.join("")}(e,A,t,r.applicationID),T=(0,f.obj)(A,e.runtime.maxBytes);""===M&&T.startsWith("&")&&(T=T.substring(1));let O="".concat(w,"?").concat(M).concat(T);!A?.attributes?.includes("gzip")&&(t!==n.EVENTS&&(k=(0,y.stringify)(k)),k.length>75e4&&1===(b[t]=(b[t]||0)+1)&&(0,d.warn)(28,t)),k&&0!==k.length&&"{}"!==k&&"[]"!==k||(k="");let B=[{key:"content-type",value:"text/plain"}],N=u({url:O,body:k,sync:i.isFinalHarvest&&o.isWorkerScope,headers:B});return!i.isFinalHarvest&&g&&(u===v.xhr?N.addEventListener("loadend",function(){let e={sent:0!==this.status,status:this.status,retry:I(this.status),fullUrl:O,xhr:this,targetApp:r};i.needResponse&&(e.responseText=this.responseText),g(e)},(0,c.eventListenerOpts)(!1)):u===v.xhrFetch&&N.then(async function(e){let t=e.status,a={sent:!0,status:t,retry:I(t),fullUrl:O,fetchResponse:e,targetApp:r};i.needResponse&&(a.responseText=await e.text()),g(a)})),(0,E.dispatchGlobalEvent)({agentIdentifier:e.agentIdentifier,drained:!!m.activatedFeatures?.[e.agentIdentifier],type:"data",name:"harvest",feature:S,data:{endpoint:t,headers:B,targetApp:r,payload:a,submitMethod:u===v.xhr?"xhr":u===v.xhrFetch?"fetch":"beacon",raw:l,synchronousXhr:!!(i.isFinalHarvest&&o.isWorkerScope)}});function I(e){switch(e){case 408:case 429:case 500:return!0}return e>=502&&e<=504||e>=512&&e<=530}}(this.agentRef,{endpoint:n.FEATURE_TO_ENDPOINT[e.featureName],targetApp:r,payload:i,localOpts:t,submitMethod:a,cbFinished:S,raw:e.harvestOpts.raw,featureName:e.featureName}),l=!0)}),l;function S(r){e.harvestOpts.prevAttemptCode&&((0,u.handle)(i.SUPPORTABILITY_METRIC_CHANNEL,[(r.retry?"Harvester/Retry/Failed/":"Harvester/Retry/Succeeded/")+e.harvestOpts.prevAttemptCode],void 0,n.FEATURE_NAMES.metrics,e.ee),delete e.harvestOpts.prevAttemptCode),r.retry&&(e.harvestOpts.prevAttemptCode=r.status),t.forceNoRetry&&(r.retry=!1),e.postHarvestCleanup(r)}}}let b={}}),r("6Wy66",function(r,a){e(r.exports,"subscribeToEOL",function(){return s});var i=t("9EKMI"),n=t("kx4OV");if(i.isWorkerScope){i.globalScope.cleanupTasks=[];let e=i.globalScope.close;i.globalScope.close=()=>{for(let e of i.globalScope.cleanupTasks)e();e()}}function s(e,t){i.isBrowserScope?(0,n.subscribeToVisibilityChange)(e,!0,t):i.isWorkerScope&&i.globalScope.cleanupTasks.push(e)}}),r("jWywI",function(t,r){e(t.exports,"cleanURL",function(){return n});var a=/([^?#]*)[^#]*(#[^?]*|$).*/,i=/([^?#]*)().*/;function n(e,t){return e.replace(t?a:i,"$1$2")}}),r("ikySP",function(r,a){e(r.exports,"obj",function(){return c}),e(r.exports,"param",function(){return g});var i=t("8KO5M"),n={"%2C":",","%3A":":","%2F":"/","%40":"@","%24":"$","%3B":";"},s=RegExp(Object.keys(n).join("|"),"g");function o(e){return n[e]}function u(e){return null==e?"null":encodeURIComponent(e).replace(s,o)}function c(e,t){var r=0,a="";return Object.entries(e||{}).forEach(([e,n])=>{var s,o,c=[];if("string"==typeof n||!Array.isArray(n)&&null!=n&&n.toString().length)s="&"+e+"="+u(n),r+=s.length,a+=s;else if(Array.isArray(n)&&n.length){for(r+=9,o=0;o<n.length&&(s=u((0,i.stringify)(n[o])),r+=s.length,void 0===t||!(r>=t));o++)c.push(s);a+="&"+e+"=%5B"+c.join(",")+"%5D"}}),a}function g(e,t,r={}){return Object.keys(r).includes(e)?"":t&&"string"==typeof t?"&"+e+"="+u(t):""}}),r("21aPu",function(r,a){e(r.exports,"getSubmitMethod",function(){return n}),e(r.exports,"xhr",function(){return o}),e(r.exports,"xhrFetch",function(){return s});var i=t("9EKMI");function n({isFinalHarvest:e=!1}={}){return e&&i.isBrowserScope?u:"undefined"!=typeof XMLHttpRequest?o:s}function s({url:e,body:t=null,method:r="POST",headers:a=[{key:"content-type",value:"text/plain"}]}){let i={};for(let e of a)i[e.key]=e.value;return fetch(e,{headers:i,method:r,body:t,credentials:"include"})}function o({url:e,body:t=null,sync:r,method:a="POST",headers:i=[{key:"content-type",value:"text/plain"}]}){let n=new XMLHttpRequest;n.open(a,e,!r);try{"withCredentials"in n&&(n.withCredentials=!0)}catch(e){}return i.forEach(e=>{n.setRequestHeader(e.key,e.value)}),n.send(t),n}function u({url:e,body:t}){try{return window.navigator.sendBeacon.bind(window.navigator)(e,t)}catch(e){return!1}}}),r("9h4E6",function(t,r){e(t.exports,"EntityManager",function(){return a});class a{#a=new Map;#i={};#n=null;constructor(e){this.agentRef=e,this.#n={licenseKey:e.info.licenseKey,applicationID:e.info.applicationID}}get(e){return e?this.#a.get(e):this.#n}getEntityGuidFor(e,t){if(this.#i[e]&&this.#i[t])return this.#i[e].filter(e=>this.#i[t].includes(e))[0]}set(e,t){this.#a.has(e)||(this.#a.set(e,t),this.#i[t.licenseKey]??=[],this.#i[t.licenseKey].push(e),this.#i[t.applicationID]??=[],this.#i[t.applicationID].push(e),this.agentRef.ee.emit("entity-added",[t]))}clear(){this.#a.clear()}setDefaultEntity(e){this.#n=e}}}),r("8fPf9",function(r,a){e(r.exports,"EventBuffer",function(){return s});var i=t("8KO5M"),n=t("iNTSX");class s{#s=[];#o=0;#u;#c;constructor(e=n.MAX_PAYLOAD_SIZE){this.maxPayloadSize=e}isEmpty(){return 0===this.#s.length}get(){return this.#s}byteSize(){return this.#o}wouldExceedMaxSize(e){return this.#o+e>this.maxPayloadSize}add(e){let t=(0,i.stringify)(e)?.length||0;return!(this.#o+t>this.maxPayloadSize)&&(this.#s.push(e),this.#o+=t,!0)}clear(){this.#s=[],this.#o=0}save(){this.#u=this.#s,this.#c=this.#o}clearSave(){this.#u=void 0,this.#c=void 0}reloadSave(){this.#u&&(this.#c+this.#o>this.maxPayloadSize||(this.#s=[...this.#u,...this.#s],this.#o=this.#c+this.#o))}}}),r("iNTSX",function(t,r){e(t.exports,"IDEAL_PAYLOAD_SIZE",function(){return a}),e(t.exports,"MAX_PAYLOAD_SIZE",function(){return i});let a=64e3,i=1e6}),r("6ShzS",function(r,a){e(r.exports,"EventAggregator",function(){return n});var i=t("f84HC");class n{#g=new(0,i.Aggregator);#h={};isEmpty({aggregatorTypes:e}){return e?e.every(e=>!this.#g.aggregatedData[e]):0===Object.keys(this.#g.aggregatedData).length}add([e,t,r,a,i]){return this.#g.store(e,t,r,a,i),!0}addMetric(e,t,r,a){return this.#g.storeMetric(e,t,r,a),!0}save({aggregatorTypes:e}){let t=e.toString(),r={};e.forEach(e=>r[e]=this.#g.aggregatedData[e]),this.#h[t]=r}get(e){let t=Array.isArray(e)?e:e.aggregatorTypes;return this.#g.take(t,!1)}clear({aggregatorTypes:e}={}){if(!e){this.#g.aggregatedData={};return}e.forEach(e=>delete this.#g.aggregatedData[e])}reloadSave({aggregatorTypes:e}){let t=e.toString(),r=this.#h[t];e.forEach(e=>{Object.keys(r[e]||{}).forEach(t=>{let a=r[e][t];this.#g.merge(e,t,a.metrics,a.params,a.custom,!0)})})}clearSave({aggregatorTypes:e}){let t=e.toString();delete this.#h[t]}}}),r("f84HC",function(t,r){e(t.exports,"Aggregator",function(){return a});class a{constructor(){this.aggregatedData={}}store(e,t,r,a,n){var s,o,u=this.#l(e,t,r,n);return s=a,(o=u.metrics)||(o={count:0}),o.count+=1,Object.entries(s||{}).forEach(([e,t])=>{o[e]=i(t,o[e])}),u.metrics=o,u}merge(e,t,r,a,s,o=!1){var u=this.#l(e,t,a,s);if(o&&(u.params=a),!u.metrics){u.metrics=r;return}var c=u.metrics;c.count+=r.count,Object.keys(r||{}).forEach(e=>{if("count"!==e){var t,a,s=c[e],o=r[e];o&&!o.c?c[e]=i(o.t,s):c[e]=(t=o,(a=c[e])?(a.c||(a=n(a.t)),a.min=Math.min(t.min,a.min),a.max=Math.max(t.max,a.max),a.t+=t.t,a.sos+=t.sos,a.c+=t.c,a):t)}})}storeMetric(e,t,r,a){var n=this.#l(e,t,r);return n.stats=i(a,n.stats),n}take(e,t=!0){for(var r={},a="",i=!1,n=0;n<e.length;n++)r[a=e[n]]=Object.values(this.aggregatedData[a]||{}),r[a].length&&(i=!0),t&&delete this.aggregatedData[a];return i?r:null}#l(e,t,r,a){this.aggregatedData[e]||(this.aggregatedData[e]={});var i=this.aggregatedData[e][t];return!i&&(i=this.aggregatedData[e][t]={params:r||{}},a&&(i.custom=a)),i}}function i(e,t){var r;return null==e?((r=t)?r.c++:r={c:1},r):t?(t.c||(t=n(t.t)),t.c+=1,t.t+=e,t.sos+=e*e,e>t.max&&(t.max=e),e<t.min&&(t.min=e),t):{t:e}}function n(e){return{t:e,min:e,max:e,sos:e*e,c:1}}});
//# sourceMappingURL=aggregate.11b57fd3.js.map

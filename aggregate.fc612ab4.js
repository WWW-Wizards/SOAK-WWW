!function(){function e(e,t,i,n){Object.defineProperty(e,t,{get:i,set:n,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire5e30,i=t.register;i("gh0jC",function(i,n){e(i.exports,"Aggregate",function(){return E});var s=t("8auZx"),r=t("73gWV"),o=t("gSI6b"),a=t("6Lc7k"),g=t("fXG8h"),h=t("12Szx"),l=t("9Cgo1"),u=t("jHSql"),p=t("9hOOR"),c=t("2cGfe"),d=t("kWizy"),f=t("cmP0c"),S=t("hEocK");class E extends a.AggregateBase{static featureName=g.FEATURE_NAME;constructor(e){super(e,g.FEATURE_NAME),this.isSessionTrackingEnabled=(0,S.canEnableSessionTracking)(e.init)&&e.runtime.session,this.ee.on(d.SESSION_EVENTS.RESET,()=>{this.abort(f.ABORT_REASONS.RESET)}),this.ee.on(d.SESSION_EVENTS.UPDATE,(e,t)=>{this.blocked||e!==d.SESSION_EVENT_TYPES.CROSS_TAB||(this.loggingMode!==g.LOGGING_MODE.OFF&&t.loggingMode===g.LOGGING_MODE.OFF?this.abort(f.ABORT_REASONS.CROSS_TAB):this.loggingMode=t.loggingMode)}),this.harvestOpts.raw=!0,this.waitForFlags(["log"]).then(([t])=>{let i=this.agentRef.runtime.session??{};if(this.loggingMode===g.LOGGING_MODE.OFF||i.isNew&&t===g.LOGGING_MODE.OFF){this.blocked=!0,this.deregisterDrain();return}i.isNew||!this.isSessionTrackingEnabled?this.updateLoggingMode(t):this.loggingMode=i.state.loggingMode,(0,s.registerHandler)(g.LOGGING_EVENT_EMITTER_CHANNEL,this.handleLog.bind(this),this.featureName,this.ee),this.drain(),e.runtime.harvester.triggerHarvestFor(this)})}updateLoggingMode(e){this.loggingMode=e,this.syncWithSessionManager({loggingMode:this.loggingMode})}handleLog(e,t,i={},n=g.LOG_LEVELS.INFO,s){if(!this.agentRef.runtime.entityManager.get(s))return(0,r.warn)(56,this.featureName);if(this.blocked||!this.loggingMode)return;if(i&&"object"==typeof i||(i={}),"string"==typeof n&&(n=n.toUpperCase()),!(0,l.isValidLogLevel)(n))return(0,r.warn)(30,n);if(this.loggingMode<(g.LOGGING_MODE[n]||1/0))return void this.reportSupportabilityMetric("Logging/Event/Dropped/Sampling");try{if("string"!=typeof t){let e=(0,o.stringify)(t);t=e&&"{}"!==e?e:String(t)}}catch(e){(0,r.warn)(16,t),this.reportSupportabilityMetric("Logging/Event/Dropped/Casting");return}if("string"!=typeof t||!t)return(0,r.warn)(32);let a=new(0,h.Log)(Math.floor(this.agentRef.runtime.timeKeeper.correctRelativeTimestamp(e)),t,i,n),u=a.message.length+(0,o.stringify)(a.attributes).length+a.level.length+10,c="Logging/Harvest/Failed/Seen";if(u>p.MAX_PAYLOAD_SIZE){this.reportSupportabilityMetric(c,u),(0,r.warn)(31,a.message.slice(0,25)+"...");return}this.events.wouldExceedMaxSize(u,s)&&(this.reportSupportabilityMetric("Logging/Harvest/Early/Seen",this.events.byteSize()+u),this.agentRef.runtime.harvester.triggerHarvestFor(this,{targetEntityGuid:s})),this.events.add(a,s)?this.reportSupportabilityMetric("Logging/Event/Added/Seen"):(this.reportSupportabilityMetric(c,u),(0,r.warn)(31,a.message.slice(0,25)+"..."))}serializer(e,t){let i=this.agentRef.runtime.entityManager.get(t),n=this.agentRef.runtime.session;return[{common:{attributes:{"entity.guid":i.entityGuid,...n&&{session:n.state.value||"0",hasReplay:1===n.state.sessionReplayMode&&(0,c.isContainerAgentTarget)(i,this.agentRef),hasTrace:1===n.state.sessionTraceMode},ptid:this.agentRef.runtime.ptid,appId:i.applicationID||this.agentRef.info.applicationID,standalone:!!this.agentRef.info.sa,agentVersion:this.agentRef.runtime.version,"instrumentation.provider":"browser","instrumentation.version":this.agentRef.runtime.version,"instrumentation.name":this.agentRef.runtime.loaderType,...this.agentRef.info.jsAttributes}},logs:(0,u.applyFnToProps)(e,this.obfuscator.obfuscateString.bind(this.obfuscator),"string")}]}queryStringsBuilder(e,t){return{browser_monitoring_key:this.agentRef.runtime.entityManager.get(t).licenseKey}}abort(e={}){this.reportSupportabilityMetric("Logging/Abort/".concat(e.sm)),this.blocked=!0,this.events&&(this.events.clear(),this.events.clearSave()),this.updateLoggingMode(g.LOGGING_MODE.OFF),this.deregisterDrain()}syncWithSessionManager(e={}){this.isSessionTrackingEnabled&&this.agentRef.runtime.session.write(e)}}}),i("12Szx",function(i,n){e(i.exports,"Log",function(){return a});var s=t("7CBaz"),r=t("8o3mY"),o=t("fXG8h");class a{timestamp;message;attributes;level;constructor(e,t,i={},n=o.LOG_LEVELS.INFO){this.timestamp=e,this.message=t,this.attributes={...i,pageUrl:(0,r.cleanURL)(""+s.initialLocation)},this.level=n.toUpperCase()}}}),i("jHSql",function(t,i){e(t.exports,"applyFnToProps",function(){return function e(t,i,n="string",s=[]){return t&&"object"==typeof t&&Object.keys(t).forEach(r=>{"object"==typeof t[r]?e(t[r],i,n,s):typeof t[r]!==n||s.includes(r)||(t[r]=i(t[r]))}),t}})})}();
//# sourceMappingURL=aggregate.fc612ab4.js.map

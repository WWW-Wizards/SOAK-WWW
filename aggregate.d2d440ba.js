!function(){function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire5e30,r=t.register;r("bcUwE",function(r,n){e(r.exports,"Aggregate",function(){return d});var i=t("8auZx"),a=t("gSI6b"),s=t("dpdfa"),o=t("hnkUQ"),u=t("kq96H"),c=t("gUmiN"),f=t("6Lc7k"),p=t("kPXiP"),l=t("huGOm");class d extends f.AggregateBase{static featureName=u.FEATURE_NAME;constructor(e){super(e,u.FEATURE_NAME),(0,o.setDenyList)(e.runtime.denyList),this.underSpaEvents={};let t=this;this.ee.on("interactionDone",(e,t)=>{this.underSpaEvents[e.id]&&(t||this.underSpaEvents[e.id].forEach(e=>this.events.add(e)),delete this.underSpaEvents[e.id])}),(0,i.registerHandler)("returnAjax",e=>this.events.add(e),this.featureName,this.ee),(0,i.registerHandler)("xhr",function(){t.storeXhr(...arguments,this)},this.featureName,this.ee),this.waitForFlags([]).then(()=>this.drain())}storeXhr(e,t,r,n,i,u){let f;t.time=r,f=e.cat?(0,a.stringify)([e.status,e.cat]):(0,a.stringify)([e.status,e.host,e.pathname]);let l=(0,o.shouldCollectEvent)(e),d=this.agentRef.init.feature_flags?.includes("ajax_metrics_deny_list");if(this.agentRef.features?.[c.FEATURE_NAMES.jserrors]&&(l||!d)&&this.agentRef.sharedAggregator?.add(["xhr",f,e,t]),!l)return void(e.hostname===this.agentRef.info.errorBeacon||this.agentRef.init.proxy?.beacon&&e.hostname===this.agentRef.init.proxy.beacon?(this.reportSupportabilityMetric("Ajax/Events/Excluded/Agent"),d&&this.reportSupportabilityMetric("Ajax/Metrics/Excluded/Agent")):(this.reportSupportabilityMetric("Ajax/Events/Excluded/App"),d&&this.reportSupportabilityMetric("Ajax/Metrics/Excluded/App")));(0,s.handle)("bstXhrAgg",["xhr",f,e,t],void 0,c.FEATURE_NAMES.sessionTrace,this.ee);let h={method:e.method,status:e.status,domain:e.host,path:e.pathname,requestSize:t.txSize,responseSize:t.rxSize,type:i,startTime:r,endTime:n,callbackDuration:t.cbTime};if(u.dt&&(h.spanId=u.dt.spanId,h.traceId=u.dt.traceId,h.spanTimestamp=Math.floor(this.agentRef.runtime.timeKeeper.correctAbsoluteTimestamp(u.dt.timestamp))),h.gql=e.gql=(0,p.parseGQL)({body:u.body,query:u.parsedOrigin?.search}),h.gql&&this.reportSupportabilityMetric("Ajax/Events/GraphQL/Bytes-Added",(0,a.stringify)(h.gql).length),this.agentRef.features?.[c.FEATURE_NAMES.softNav])(0,s.handle)("ajax",[h],void 0,c.FEATURE_NAMES.softNav,this.ee);else if(u.spaNode){let e=u.spaNode.interaction.id;this.underSpaEvents[e]??=[],this.underSpaEvents[e].push(h)}else this.events.add(h)}serializer(e){if(!e.length)return;let t=(0,l.getAddStringContext)(this.agentRef.runtime.obfuscator),r="bel.7;";for(let n=0;n<e.length;n++){let i=e[n],a=[(0,l.numeric)(i.startTime),(0,l.numeric)(i.endTime-i.startTime),(0,l.numeric)(0),(0,l.numeric)(0),t(i.method),(0,l.numeric)(i.status),t(i.domain),t(i.path),(0,l.numeric)(i.requestSize),(0,l.numeric)(i.responseSize),"fetch"===i.type?1:"",t(0),(0,l.nullable)(i.spanId,t,!0)+(0,l.nullable)(i.traceId,t,!0)+(0,l.nullable)(i.spanTimestamp,l.numeric,!1)],s="2,",o=this.agentRef.info.jsAttributes,u=(0,l.addCustomAttributes)({...o||{},...i.gql||{}},t);a.unshift((0,l.numeric)(u.length)),s+=a.join(","),u&&u.length>0&&(s+=";"+u.join(";")),n+1<e.length&&(s+=";"),r+=s}return r}}}),r("kPXiP",function(r,n){e(r.exports,"parseGQL",function(){return a});var i=t("hFfWt");function a({body:e,query:t}={}){if(e||t)try{let r=function(e){if(!e)return;Array.isArray(e)||(e=[e]);let t=[],r=[];for(let n of e){let e=s(n);e&&(t.push(e.operationName),r.push(e.operationType))}if(r.length)return{operationName:t.join(","),operationType:r.join(","),operationFramework:"GraphQL"}}(o(e));if(r)return r;let n=s(function(e){if(e&&"string"==typeof e)return o(Object.fromEntries(new URLSearchParams(e)))}(t));if(n)return n}catch(e){}}function s(e){if("object"!=typeof e||!e.query||"string"!=typeof e.query)return;let t=e.query.trim().match(/^(query|mutation|subscription)\s?(\w*)/),r=t?.[1];if(r)return{operationName:e.operationName||t?.[2]||"Anonymous",operationType:r,operationFramework:"GraphQL"}}function o(e){let t;if(!e||"string"!=typeof e&&"object"!=typeof e)return;if(t="string"==typeof e?JSON.parse(e):e,!(0,i.isPureObject)(t)&&!Array.isArray(t))return;let r=!1;if(Array.isArray(t)?t.some(e=>u(e)):u(t))return t}function u(e){return!("object"!=typeof e||!e.query||"string"!=typeof e.query)}}),r("hFfWt",function(t,r){e(t.exports,"isPureObject",function(){return n});function n(e){return e?.constructor===({}).constructor}}),r("huGOm",function(r,n){e(r.exports,"nullable",function(){return s}),e(r.exports,"numeric",function(){return o}),e(r.exports,"getAddStringContext",function(){return u}),e(r.exports,"addCustomAttributes",function(){return c});var i=t("gSI6b"),a=Object.prototype.hasOwnProperty;function s(e,t,r){return e||0===e||""===e?t(e)+(r?",":""):"!"}function o(e,t){return t?Math.floor(e).toString(36):void 0===e||0===e?"":Math.floor(e).toString(36)}function u(e){let t=0,r=Object.prototype.hasOwnProperty.call(Object,"create")?Object.create(null):{};return function(n){return void 0===n||""===n?"":(n=e.obfuscateString(String(n)),a.call(r,n))?o(r[n],!0):(r[n]=t++,"'"+n.replace(f,"\\$1"))}}function c(e,t){var r=[];return Object.entries(e||{}).forEach(([e,n])=>{if(!(r.length>=64)){var a,s=5;switch(e=t(e),typeof n){case"object":n?a=t((0,i.stringify)(n)):s=9;break;case"number":s=6,a=n%1?n:n+".";break;case"boolean":s=n?7:8;break;case"undefined":s=9;break;default:a=t(n)}r.push([s,e+(a?","+a:"")])}}),r}var f=/([,\\;])/g})}();
//# sourceMappingURL=aggregate.d2d440ba.js.map
